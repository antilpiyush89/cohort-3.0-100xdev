<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Auth Website</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.7.7/axios.min.js"></script>
</head>
<body>
  <div>
    SignUp
    <input id="signup-username" type="text" placeholder="Username">
    <input id="signup-password" type="text" placeholder="Password">
    <button onclick="signup()">Submit</button>
  </div>
  <div>
    SignIn
    <input id="signin-username" type="text" placeholder="Username">
    <input id="signin-password" type="text" placeholder="Password">
    <button onclick="signin()">Submit</button>
  </div>
  <div id="userinfo">User Information: </div>
  <div><button onclick="logout()">Logout</button></div>

  <script>
    async function signup(){
      const username=document.getElementById("signup-username").value
      const password=document.getElementById("signup-password").value
      await axios.post("http://localhost:3000/signup",{ // sending request using axios, just like we send request using postman
        username:username, // exactly like we do in the body of postman
        password:password
      }) // Promise under the hood, it can take x sec, hence we await 
      alert("you are signed Up");
    }
    async function signin(){
      const username=document.getElementById("signin-username").value
      const password=document.getElementById("signin-password").value
      const response=await axios.post("http://localhost:3000/signin",{ // sending request using axios, just like we send request using postman
        username:username, // exactly like we do in the body of postman
        password:password
      }) // Promise under the hood, it can take x sec, hence we await 
      
      localStorage.setItem("token",response.data.token) 
      //response.data: This property contains the actual data returned by the server. In this case, it's an object that contains the token generated by the server for the signed-in user.

      //Inspect -> Application -> Localstorage ke ander jwt ko store kar rahe hain, browser ke ander hi
      // Session persist till you logout, for however times you reload the website the session presist the token remain same, when you logout token get removed, when you login again you get a new token
      alert("you are signed In");
      
      
    }

    //when you reload the page
    async function getuserinfo(){
      const response=await axios.get("http://localhost:3000/me",{
        headers:{ // bcz ham req.headers.token karte h in backend
          token:localStorage.getItem("token") // fetches the token value from local storage
        }
      }) // request mein headers bhejne hi padenge, read Auth_JWT_middleware /me code, headers se token ko authorise karega aur username aur password nikalega
      
      document.getElementById("userinfo").innerHTML="User Information: Username: " + response.data.username + " Password: "+  response.data.password;
    }
    getuserinfo()

    function logout(){
      localStorage.removeItem("token") //token is removed hence logout
    }
  </script>
</body>
</html>